# 快速启动指南

## 更新后首次启动

### 步骤 1：数据库迁移（必须执行）

打开命令行，进入后端目录并执行迁移：

```bash
cd backend
python -m flask db upgrade
```

如果遇到错误，可以直接在MySQL中执行以下SQL：

```sql
USE hospital_db;

ALTER TABLE medical_records 
ADD COLUMN medical_history TEXT NULL AFTER treatment_plan,
ADD COLUMN allergy_history TEXT NULL AFTER medical_history;
```

### 步骤 2：启动后端服务

```bash
# 在 backend 目录下
python app.py
```

后端服务将在 `http://127.0.0.1:5000` 启动

### 步骤 3：启动前端服务

打开新的命令行窗口：

```bash
cd frontend
npm install  # 如果是首次运行
npm run dev
```

前端服务将在 `http://localhost:5173` 启动（或其他可用端口）

### 步骤 4：访问系统

在浏览器中打开前端地址（通常是 `http://localhost:5173`）

## 新功能快速体验

### 1. 查看新的界面布局

- 登录系统后选择任意科室
- 你会看到全新的表格布局界面
- 病人列表占据了主要空间

### 2. 体验病历编辑功能

1. 点击任意病人行的"病历编辑"按钮
2. 在弹出窗口左侧可以看到历史病历列表
3. 点击"+ 新增病历"
4. 填写诊断、治疗方案、既往病史、过敏史
5. 点击"添加病历"保存

### 3. 使用模板功能

**方法一：从病历导出模板**
1. 在病历编辑窗口选择一条已有病历
2. 点击右上角"📤 导出为模板"
3. 输入模板名称

**方法二：导入模板**
1. 在病历编辑窗口，点击"选择模板"下拉框
2. 选择一个模板
3. 模板内容会自动填充到各个字段

**方法三：模板管理**
1. 点击顶部"模板管理"按钮
2. 可以创建新模板或编辑现有模板
3. 模板现在支持既往病史和过敏史字段

## 常见问题

### Q: 启动后端时提示"No module named 'flask_sqlalchemy'"

A: 需要安装依赖：
```bash
pip install flask flask-sqlalchemy flask-cors flask-migrate flask-jwt-extended pymysql
```

### Q: 前端页面是空白的

A: 检查：
1. 后端服务是否正常运行
2. 浏览器控制台是否有错误信息
3. 检查 `frontend/src/api/apiClient.js` 中的后端地址是否正确

### Q: 数据库迁移失败

A: 
1. 确保MySQL服务正在运行
2. 检查 `backend/app.py` 中的数据库连接配置
3. 使用手动SQL方式执行迁移

### Q: 旧的病历数据会丢失吗？

A: 不会！新字段为可选字段，旧数据完全兼容。既往病史和过敏史字段在旧病历中为空值。

## 系统架构

```
医院病历管理系统
├── 后端 (Flask + MySQL)
│   ├── app.py - 主应用文件
│   ├── migrations/ - 数据库迁移文件
│   └── 数据模型：
│       ├── User（用户）
│       ├── Patient（病人）
│       ├── MedicalRecord（病历）★ 新增字段
│       └── Template（模板）★ 支持新字段
│
└── 前端 (Vue 3)
    ├── src/
    │   ├── components/
    │   │   ├── Login.vue - 登录组件
    │   │   ├── DepartmentView.vue - ★ 重构的科室视图
    │   │   ├── TemplateManager.vue - ★ 更新的模板管理
    │   │   └── PatientManager.vue - 旧组件（已不使用）
    │   ├── api/
    │   │   └── apiClient.js - API客户端
    │   ├── App.vue - 主应用
    │   └── style.css - ★ 优化的全局样式
    └── public/
```

## 技术栈

- **后端**: Flask 2.x + SQLAlchemy + MySQL
- **前端**: Vue 3 (Composition API) + Vite
- **认证**: JWT (JSON Web Tokens)
- **样式**: 原生 CSS + CSS Variables

## 开发团队提示

### 代码结构改进

1. **DepartmentView.vue**：完全重构，采用表格布局，左右分栏的病历编辑
2. **API接口**：新增 `PUT /api/patients/<patient_id>/records/<record_id>` 用于更新病历
3. **数据模型**：`medical_history` 和 `allergy_history` 为 TEXT 类型，可存储大量文本

### 样式规范

所有输入框现在遵循统一规范：
- 背景色：`#ffffff`（白色）
- 文字颜色：`#2d3748`（深灰色）
- 边框：`1px solid #e2e8f0`
- 聚焦时：蓝紫色边框 + 浅色阴影

---

祝使用愉快！

